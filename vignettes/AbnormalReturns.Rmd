---
title: "AbnormalReturns Vignette"
author: 
 - "Axel Perschmann"
 - "Stefan Feuerriegel"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Computation of abnormal returns based on event study methodology}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

**AbnormalReturns** implements the event study methodology and abnormal returns in particular. The event study methodology is a common way to study the effects of certain events on stock prices. It thus calculates a so-called abnormal return that measures the impact without confounding influences. As part of this method, one first has to predict a normal return in the absence of the event under study. Afterwards, one calculates the difference between the actual return and the previously predicted normal return, i.e. the abnormal return.

$AR_c(\tau) = R_c(\tau) - E(R_c(\tau)|\neg X_\tau)$, where

Variable | Description
------------- | ----------------------------
$AR_c(\tau)$ | abnormal return
$R_c(\tau)$  | actual return
$E(R_c(\tau)|\neg X_\tau)$ | normal return, estimated during a time interval named *estimation window*.

According to MacKinlay (1997), we calculate the normal return by the so-called *market model*. This model relies on the assumptions that asset returns are jointly multivariate normal and independently and identically distributed through time. This assumption might seem strong, but is, in practice, empirically reasonable (MacKinlay 1997). The market model assumes a stable linear relation between the market return $R_m(t)$ and the normal return, i.e. the return of the market portfolio. More precisely, the market model is for any commodity $c$

$R_c(t) = \alpha_c + \beta_cR_m(t) + \epsilon_{c,t}$, &nbsp;&nbsp;&nbsp; $E(\epsilon_{c,t})=0$, &nbsp;&nbsp;   $Var(\epsilon_{c,t})=\sigma^2_{e_c}$

where $R_c(t)$ and $R_m(t)$ are returns in period $t$ of commodity $c$ and on the market portfolio $m$, respectively, and $\epsilon_{c,t}$ is the zero mean disturbance term. $\alpha_c$, $\beta_c$ and $\sigma^2_{e_c}$ are the parameters of the market model, determined from a regression such as *ordinary least squares (OLS)* based on the values from the estimation window.

Ultimately, the abnormal return in period $\tau$ is computed by

$AR_c(\tau) := R_c(\tau) - \alpha_c - \beta_cR_m(\tau)$.

## Implementation
Interaly the OLS regression is implemented as follows:

```{r, eval=FALSE}
returns_stock = prices_stock[indices.Estimation, ][['Close']]
returns_market = prices_market[indices.Estimation, ][['Close']]

M = lm(returns_stock ~ return_market)
```

The final computation of the abnormal returns is implemented as follows:
```{r, eval=FALSE}
event_return_stock = stock[idx, ][['Close']]
event_return_market = market[idx, ][['Close']]

nd = data.frame(returns_market = event_return_market)
abnormal = event_return_commodity - predict(M, newdata = nd)
```

## Example
This simple example reads data from two stock data sets downloaded from the Yahoo Finance platform^[https://de.finance.yahoo.com/q/hp?s=%5EGDAXI accessed 24-July-2016] ^[https://de.finance.yahoo.com/q/hp?s=ADS.DE accessed 24-July-2016].

This package comes with three data sets precompiled and ready to use: `d.DAX`, `d.Adidas`, `d.VW`. They contain daily stock details for 253 workdays in 2015.

```{r, eval=FALSE}
d.DAX <- read.csv("../data-raw/DAX_2015.csv", stringsAsFactors = FALSE)
d.DAX$Date <- as.POSIXct(d.DAX$Date)
d.DAX <- d.DAX[order(d.DAX$Date),]
comment(d.DAX) <- 'DAX'
head(d.DAX)

d.Adidas <- read.csv("../data-raw/DAX_2015_Adidas.csv", stringsAsFactors = FALSE)
d.Adidas <- d.Adidas[d.Adidas$Volume != 0, ]
d.Adidas$Date <- as.POSIXct(d.Adidas$Date)
d.Adidas <- d.Adidas[order(d.Adidas$Date),]
comment(d.Adidas) <- 'Adidas'
head(d.Adidas)
```

In a next step `computeAbnormalReturns()` computes the abnormal returns for commodity Adidas and market portfolio DAX for the year 2015, based on an `estimationWindowLength` of 20.

The result is a data-frame with one row per abnormal return and five columns describing Date, abnormalReturn, R.squared, commodityReturn and portfolioReturn.
```{r}
library(AbnormalReturns)
abnormal <- computeAbnormalReturn(prices_stock = d.Adidas, prices_market = d.DAX)
head(abnormal)
summary(abnormal$R.squared)
summary(abnormal$abnormalReturn)
```


## Figures

An optional parameter `showPlot` defines wether or not the commodity performance together with the computed abnormal return shall be visualized.

```{r, eval=FALSE}
computeAbnormalReturn(prices_stock = d.Adidas, prices_market = d.DAX, showPlot = TRUE)
computeAbnormalReturn(prices_stock = d.Adidas, prices_market = d.DAX, showPlot = TRUE, eventIndex = 125)
```

```{r, echo=FALSE}
x <- computeAbnormalReturn(prices_stock = d.Adidas, prices_market = d.DAX, showPlot = TRUE)
x <- computeAbnormalReturn(prices_stock = d.Adidas, prices_market = d.DAX, showPlot = TRUE, eventIndex = 125)
```

